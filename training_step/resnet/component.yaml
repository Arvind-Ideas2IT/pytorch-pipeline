name: train_pytorch_cnn
description: Train PyTorch ImageNet CNN

inputs:
  - {name: TrainingData, type: String, description: 'Path to the training data'}
  - {name: MaxEpochs, type: Integer, description: 'Maximum number of epochs'}
  - {name: TrainBatchSize, type: Integer, description: 'Training batch size'}
  - {name: ValBatchSize, type: Integer, description: 'Validation batch size'}
  - {name: TrainNumWorkers, type: Integer, description: 'Number of training workers'}
  - {name: ValNumWorkers, type: Integer, description: 'Number of validation workers'}
  - {name: LearningRate, type: Float, description: 'Learning rate'}
  - {name: Gpus, type: Integer, description: 'Number of gpus'}
  - {name: Accelerator, type: String, description: 'Accelerator for multi gpu setting'}

outputs:
  - name: ModelCheckpoint
    type: String
    description: "Path for the resulting model checkpoint"
  - name: TensorboardRoot
    type: String
    description: "Path for the tensorboard logs"

implementation:
  container:
    image: jagadeeshj/training_step:22-02-2021-12-23-59.762171
    command: ["python","/component/entry_point.py"]

    args: [
        --train_glob, {inputPath: TrainingData},
        --model_save_path, {outputPath: ModelCheckpoint},
        --tensorboard_root, {outputPath: TensorboardRoot},
        --max_epochs, {inputValue: MaxEpochs},
        --gpus, {inputValue: Gpus},
        --train_batch_size, {inputValue: TrainBatchSize},
        --val_batch_size, {inputValue: ValBatchSize},
        --train_num_workers, {inputValue: TrainNumWorkers},
        --val_num_workers, {inputValue: ValNumWorkers},
        --learning_rate, {inputValue: LearningRate},
        --accelerator, {inputValue: Accelerator},
    ]
